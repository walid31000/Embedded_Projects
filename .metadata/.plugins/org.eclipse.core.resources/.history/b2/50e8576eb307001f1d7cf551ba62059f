/*
 * main.c
 *description:Motor Dashboard
 *  Created on: 26 Apr 2024
 *      Author: walid
 */


#include "STD_TYPES.h"
#include "BIT_MATH.h"
#include "Err_Type.h"
#include <util/delay.h>

#include "DIO_interface.h"
#include "PORT_interface.h"
#include "DC_interface.h"
#include "Stepper_interface.h"
#include "KPD_interface.h"
#include "CLCD_interface.h"



void main(void)
{
	uint8 Local_u8Key=0xff;
	uint16 Local_u16Angle=0;
	uint8 flag=0;
	DC_config_t DC_Motor={DIO_PORTD,DIO_PIN6,DIO_PIN7 };
	Stepper_config_t Stepper={DIO_PORTD,DIO_PIN0,DIO_PIN1,DIO_PIN2,DIO_PIN3};

	PORT_voidIint();
	CLCD_voidInit ();
	Hamoksha();
	CLCD_u8SendStringAtPos(0u,0u,"DC MOTOR ---->1");
	CLCD_u8SendStringAtPos(0u,1u,"STEPER MOTOR->2");

	while(1)
	{

		Local_u8Key=KPD_u8GetPressedKey();

		if(Local_u8Key!=0xff )
		{

			CLCD_voidSendNumber(Local_u8Key);
			if ((Local_u8Key==1)&&(flag==0))
			{
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Rot CW ->1");
				CLCD_u8SendStringAtPos(0u,1u,"Rot CCW->2");

				flag=1;




			}
			else if((Local_u8Key==1)&&(flag==1))
			{
				Motor_voidRotateCW( &DC_Motor);
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Press 0 to stop");
				flag=1;

			}




			else if((Local_u8Key==2)&&(flag==1))
			{
				Motor_voidRotateCCW( &DC_Motor);
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Press 0 to stop");

			}


			if((Local_u8Key==0)&&(flag==1))
			{
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Thanks");

				Motor_voidStop(&DC_Motor);break;

			}







		else if ((Local_u8Key==2)&&(flag==0))
			{
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Rot CW ->1");
				CLCD_u8SendStringAtPos(0u,1u,"Rot CCW->2");

				flag=2;




			}
			else if((Local_u8Key==1)&&(flag==2))
			{
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Enter Angle");
				flag=0;

			}
			if((Local_u8Key>=0) && (Local_u8Key<=9)&&(flag==0))
			{
				//CLCD_voidSendNumber(Local_u8Key);
				Local_u16Angle=Local_u16Angle*10+Local_u8Key;
               //flag=1;

			}
			if((Local_u8Key==10) &&(flag==0))
			{
				Stepper_u8Stepper_Rotate( &Stepper, Local_u16Angle,Clock_Wise_ROT );


			}


			else if((Local_u8Key==2)&&(flag==1))
			{
				CLCD_voidSendCommand(1);
				CLCD_u8SendStringAtPos(0u,0u,"Enter Angle");
				flag=1;

			}
			if((Local_u8Key=='c') &&(flag==1))
			{
				Stepper_u8Stepper_Rotate( &Stepper, Local_u16Angle,Counter_Clock_Wise_ROT );


			}





	}




	}






}









